# å°ˆæ¡ˆä¿®æ”¹èªªæ˜

## ğŸ“‹ ä¿®æ”¹ç¸½è¦½

æ ¹æ“šæ‚¨çš„è¦æ±‚ï¼Œå·²å®Œæˆä»¥ä¸‹å…©é …é‡è¦ä¿®æ”¹ï¼š

### âœ… 1. ç§»é™¤ Switch Statementï¼Œæ”¹ç‚º Divergent Change

**ä½ç½®**: `FrontDeskStaff.java`

#### ä¿®æ”¹å‰ï¼ˆCode Smell #6: Switch Statementï¼‰
```java
public double calculateSalary(String position) {
    double salary = 0;
    switch (position) {
        case "junior": salary = 30000; break;
        case "senior": salary = 45000; break;
        case "manager": salary = 60000; break;
        case "director": salary = 80000; break;
        default: salary = 25000;
    }
    return salary;
}
```

#### ä¿®æ”¹å¾Œï¼ˆCode Smell #6: Divergent Changeï¼‰
```java
// é¡åˆ¥å› ç‚ºå¤šç¨®ä¸åŒåŸå› éœ€è¦ä¿®æ”¹
private double seniorStaffBonus = 15000;    // ç•¶çé‡‘æ”¿ç­–æ”¹è®Šæ™‚ä¿®æ”¹
private double managerBonus = 30000;        // ç•¶çé‡‘æ”¿ç­–æ”¹è®Šæ™‚ä¿®æ”¹
private double directorBonus = 50000;       // ç•¶çé‡‘æ”¿ç­–æ”¹è®Šæ™‚ä¿®æ”¹
private String peakSeasonSurcharge = "20%"; // ç•¶å®šåƒ¹æ”¿ç­–æ”¹è®Šæ™‚ä¿®æ”¹
private String loyaltyDiscountRate = "10%"; // ç•¶æŠ˜æ‰£æ”¿ç­–æ”¹è®Šæ™‚ä¿®æ”¹

// æ–¹æ³•1ï¼šç•¶è–ªè³‡è¨ˆç®—æ”¿ç­–æ”¹è®Šæ™‚éœ€ä¿®æ”¹
public double calculateSalaryWithBonus(String position) { ... }

// æ–¹æ³•2ï¼šç•¶æˆ¿åƒ¹å®šåƒ¹æ”¿ç­–æ”¹è®Šæ™‚éœ€ä¿®æ”¹
public double calculateRoomPrice(int nights, boolean isPeakSeason) { ... }

// æ–¹æ³•3ï¼šç•¶æŠ˜æ‰£æ”¿ç­–æ”¹è®Šæ™‚éœ€ä¿®æ”¹
public double applyLoyaltyDiscount(double amount, boolean isLoyalMember) { ... }
```

**ç‚ºä»€éº¼æ”¹æˆ Divergent Changeï¼Ÿ**
- âœ… æ›´èƒ½å±•ç¤º**å–®ä¸€è·è²¬åŸå‰‡**çš„é•å
- âœ… å±•ç¤ºä¸€å€‹é¡åˆ¥å› ç‚º**å¤šç¨®ä¸åŒåŸå› **éœ€è¦ä¿®æ”¹çš„å•é¡Œ
- âœ… æ›´è²¼è¿‘å¯¦éš›å°ˆæ¡ˆä¸­å¸¸è¦‹çš„è¨­è¨ˆå•é¡Œ
- âœ… æä¾›æ›´è±å¯Œçš„æ•™å­¸åƒ¹å€¼

---

### âœ… 2. ä¿®æ”¹ Refused Bequest ç‚ºçœŸæ­£çš„ç¹¼æ‰¿å•é¡Œ

**ä½ç½®**: `Hotel.java` å’Œ `Person.java`

#### ä¿®æ”¹å‰
Hotel é¡åˆ¥æœ‰ä¸€å€‹ `manageAllServices()` æ–¹æ³•è™•ç†æ‰€æœ‰æœå‹™ï¼ˆé€™æ˜¯ Refused Bequest çš„è®Šé«”ï¼‰

#### ä¿®æ”¹å¾Œï¼ˆCode Smell #14: Refused Bequest - æ‹’çµ•ç¹¼æ‰¿ï¼‰

**Person.java æ–°å¢æ–¹æ³•**ï¼š
```java
// çˆ¶é¡åˆ¥æä¾›çš„æ–¹æ³•ï¼Œä¾›å­é¡åˆ¥ç¹¼æ‰¿
public void reportWorkSchedule() {
    System.out.println("Work schedule not specified");
}

public double calculatePerformanceBonus() {
    return 0.0;
}
```

**Hotel.java ç¹¼æ‰¿ Person**ï¼š
```java
// Hotel ä¸æ‡‰è©²æ˜¯ Personï¼Œä½†è¢«å¼·åˆ¶ç¹¼æ‰¿
public class Hotel extends Person {
    
    public Hotel(String hotelName, String address) {
        // è¢«è¿«å‘¼å«çˆ¶é¡åˆ¥å»ºæ§‹å­ï¼Œå‚³å…¥ç„¡æ„ç¾©çš„å€¼
        super("Hotel Entity", 0, "N/A");
        this.hotelName = hotelName;
        this.address = address;
    }
    
    // ç¹¼æ‰¿äº†æ–¹æ³•ä½†ä¸å¯¦ä½œ - æ‹’çµ•ä½¿ç”¨çˆ¶é¡åˆ¥çš„éºç”¢
    @Override
    public void reportWorkSchedule() {
        // ç©ºå¯¦ä½œï¼ŒHotel ä¸æ‡‰è©²æœ‰ã€Œå·¥ä½œæ™‚é–“è¡¨ã€
    }
    
    @Override
    public double calculatePerformanceBonus() {
        // å›å‚³ 0ï¼ŒHotel ä¸æ‡‰è©²æœ‰ã€Œç¸¾æ•ˆçé‡‘ã€
        return 0.0;
    }
}
```

**ç‚ºä»€éº¼é€™æ¨£æ”¹ï¼Ÿ**
- âœ… å±•ç¤º**çœŸæ­£çš„ Refused Bequest**ï¼šå­é¡åˆ¥ç¹¼æ‰¿çˆ¶é¡åˆ¥ä½†ä¸å¯¦åš
- âœ… é•å **Liskov æ›¿æ›åŸå‰‡**ï¼šHotel ä¸æ˜¯ Personï¼Œä¸æ‡‰è©²ç¹¼æ‰¿
- âœ… å±•ç¤º**ä¸åˆç†çš„ç¹¼æ‰¿é—œä¿‚**ï¼šis-a é—œä¿‚ä¸æˆç«‹
- âœ… å­é¡åˆ¥è¢«è¿«å¯¦ä½œä¸éœ€è¦çš„æ–¹æ³•

---

## ğŸ¯ å®Œæ•´çš„ 15 å€‹ Code Smell åˆ—è¡¨

| # | Code Smell | ä½ç½® | èªªæ˜ |
|---|-----------|------|------|
| 1 | Long Class | FrontDeskStaff.java | é¡åˆ¥éé•·ï¼Œè·è²¬éå¤š |
| 2 | Magic Number | FrontDeskStaff.java | ä½¿ç”¨é­”è¡“æ•¸å­— |
| 3 | Long Method | FrontDeskStaff.java | æ–¹æ³•éé•· |
| 4 | Duplicate Code | FrontDeskStaff.java | é‡è¤‡ç¨‹å¼ç¢¼ |
| 5 | Feature Envy | FrontDeskStaff.java | éåº¦ä½¿ç”¨å…¶ä»–é¡åˆ¥çš„è³‡æ–™ |
| 6 | **Divergent Change** â­ | FrontDeskStaff.java | é¡åˆ¥å› å¤šç¨®åŸå› éœ€ä¿®æ”¹ |
| 7 | Data Class | Housekeeper.java | åªæœ‰è³‡æ–™æ²’æœ‰è¡Œç‚º |
| 8 | Long Parameter List | Housekeeper.java | åƒæ•¸éå¤š |
| 9 | Primitive Obsession | Chef.java | éåº¦ä½¿ç”¨åŸºæœ¬é¡å‹ |
| 10 | Dead Code | Chef.java | æœªä½¿ç”¨çš„ç¨‹å¼ç¢¼ |
| 11 | Speculative Generality | Chef.java | éåº¦è¨­è¨ˆ |
| 12 | God Class | Hotel.java | ä¸Šå¸é¡åˆ¥ï¼Œç®¡ç†å¤ªå¤šäº‹æƒ… |
| 13 | Message Chain | Hotel.java | è¨Šæ¯éˆéé•· |
| 14 | **Refused Bequest** â­ | Hotel.java | ç¹¼æ‰¿ä½†ä¸å¯¦åš |
| 15 | Unsuitable Naming | Room.java | ä¸ç•¶å‘½å |

â­ = æœ¬æ¬¡ä¿®æ”¹çš„é …ç›®

---

## ğŸ“ ä¸»è¦ä¿®æ”¹æª”æ¡ˆ

### 1. Person.java
```diff
+ // æ–°å¢å…©å€‹æ–¹æ³•ä¾›å­é¡åˆ¥ç¹¼æ‰¿
+ public void reportWorkSchedule() { ... }
+ public double calculatePerformanceBonus() { ... }
```

### 2. FrontDeskStaff.java
```diff
- // ç§»é™¤ CODE SMELL 6: Switch Statement
- public double calculateSalary(String position) { ... }

+ // æ–°å¢ CODE SMELL 6: Divergent Change
+ private double seniorStaffBonus = 15000;
+ private double managerBonus = 30000;
+ private double directorBonus = 50000;
+ private String peakSeasonSurcharge = "20%";
+ private String loyaltyDiscountRate = "10%";
+ 
+ public double calculateSalaryWithBonus(String position) { ... }
+ public double calculateRoomPrice(int nights, boolean isPeakSeason) { ... }
+ public double applyLoyaltyDiscount(double amount, boolean isLoyalMember) { ... }
```

### 3. Hotel.java
```diff
- // åŸæœ¬ä¸ç¹¼æ‰¿ä»»ä½•é¡åˆ¥
- public class Hotel {

+ // ç¾åœ¨ç¹¼æ‰¿ Personï¼ˆä¸åˆç†çš„ç¹¼æ‰¿ï¼‰
+ public class Hotel extends Person {
+     
+     public Hotel(String hotelName, String address) {
+         super("Hotel Entity", 0, "N/A"); // è¢«è¿«å‘¼å«çˆ¶é¡åˆ¥å»ºæ§‹å­
+     }
+     
+     // æ‹’çµ•å¯¦åšçˆ¶é¡åˆ¥æ–¹æ³•
+     @Override
+     public void reportWorkSchedule() { }
+     
+     @Override
+     public double calculatePerformanceBonus() { return 0.0; }
```

### 4. Main.java
```diff
- // æ¸¬è©¦ Switch Statement
- System.out.println("Junior salary: " + staff.calculateSalary("junior"));

+ // æ¸¬è©¦ Divergent Change
+ System.out.println("Junior salary: " + staff.calculateSalaryWithBonus("junior"));
+ System.out.println("Senior salary: " + staff.calculateSalaryWithBonus("senior"));
+ System.out.println("Peak season price: " + staff.calculateRoomPrice(3, true));
+ System.out.println("Loyalty discount: " + staff.applyLoyaltyDiscount(5000, true));

+ // æ¸¬è©¦ Refused Bequest
+ System.out.println("=== Testing Refused Bequest ===");
+ hotel.reportWorkSchedule(); // ç©ºå¯¦ä½œ
+ System.out.println("Hotel performance bonus: " + hotel.calculatePerformanceBonus());
```

### 5. CODE_SMELL_DOCUMENTATION.md
- **ç¬¬ 6 é …**ï¼šå®Œæ•´é‡å¯«ï¼Œå¾ Switch Statement æ”¹ç‚º Divergent Change
- **ç¬¬ 14 é …**ï¼šå®Œæ•´é‡å¯«ï¼Œå¾è®Šé«”æ”¹ç‚ºçœŸæ­£çš„ Refused Bequest
- **ç¸½çµéƒ¨åˆ†**ï¼šæ›´æ–°å„ªå…ˆé †åºåˆ—è¡¨

---

## âœ… æ¸¬è©¦çµæœ

### ç·¨è­¯
```
âœ… ç·¨è­¯æˆåŠŸï¼Œç„¡éŒ¯èª¤
```

### åŸ·è¡Œ
```
âœ… ç¨‹å¼æ­£å¸¸åŸ·è¡Œ
âœ… å±•ç¤ºæ‰€æœ‰ 15 å€‹ Code Smell
âœ… Divergent Change æ­£å¸¸é‹ä½œ
âœ… Refused Bequest æ­£å¸¸é‹ä½œ
```

### è¼¸å‡ºç¯„ä¾‹
```
Junior salary: 30000.0
Senior salary: 45000.0
Manager salary: 60000.0
Peak season price (3 nights): 7200.0
Loyalty discount on $5000: 4500.0

=== Testing Refused Bequest ===
Hotel name: Five Star Grand Hotel
Hotel performance bonus: 0.0
```

---

## ğŸ“š å­¸ç¿’é‡é»

### Divergent Changeï¼ˆç™¼æ•£å¼è®ŠåŒ–ï¼‰
**å•é¡Œ**: ä¸€å€‹é¡åˆ¥å› ç‚ºå¤šç¨®ä¸åŒçš„åŸå› è€Œéœ€è¦ä¿®æ”¹

**è­˜åˆ¥æ–¹æ³•**:
- å•ï¼šã€Œé€™å€‹é¡åˆ¥æœƒå› ç‚ºä»€éº¼åŸå› è€Œéœ€è¦ä¿®æ”¹ï¼Ÿã€
- å¦‚æœç­”æ¡ˆæ˜¯å¤šå€‹ä¸åŒçš„åŸå›  â†’ Divergent Change

**è§£æ±ºæ–¹æ³•**:
- æ‹†åˆ†é¡åˆ¥ï¼Œæ¯å€‹é¡åˆ¥åªæœ‰ä¸€å€‹è®Šæ›´åŸå› 
- ä½¿ç”¨çµ„åˆ (Composition) è€Œéå°‡æ‰€æœ‰é‚è¼¯æ”¾åœ¨ä¸€å€‹é¡åˆ¥
- éµå¾ªå–®ä¸€è·è²¬åŸå‰‡ (Single Responsibility Principle)

### Refused Bequestï¼ˆæ‹’çµ•ç¹¼æ‰¿ï¼‰
**å•é¡Œ**: å­é¡åˆ¥ç¹¼æ‰¿çˆ¶é¡åˆ¥ï¼Œä½†ä¸ä½¿ç”¨æˆ–ä¸é©ç•¶ä½¿ç”¨çˆ¶é¡åˆ¥çš„æ–¹æ³•

**è­˜åˆ¥æ–¹æ³•**:
- å­é¡åˆ¥è¦†å¯«æ–¹æ³•ä½†ç•™ç©ºæˆ–æ‹‹å‡ºç•°å¸¸
- ç¹¼æ‰¿é—œä¿‚ä¸ç¬¦åˆ is-a é—œä¿‚
- å­é¡åˆ¥åªä½¿ç”¨çˆ¶é¡åˆ¥çš„ä¸€å°éƒ¨åˆ†åŠŸèƒ½

**è§£æ±ºæ–¹æ³•**:
- ç§»é™¤ä¸åˆç†çš„ç¹¼æ‰¿é—œä¿‚
- ä½¿ç”¨çµ„åˆ (Composition) è€Œéç¹¼æ‰¿ (Inheritance)
- ä½¿ç”¨ä»‹é¢å®šç¾©å…±åŒè¡Œç‚º
- ç¢ºä¿ç¬¦åˆ Liskov æ›¿æ›åŸå‰‡

---

## ğŸ“ è¨­è¨ˆåŸå‰‡

### SOLID åŸå‰‡ç›¸é—œ
- **S - Single Responsibility Principle**: Divergent Change é•åæ­¤åŸå‰‡
- **L - Liskov Substitution Principle**: Refused Bequest é•åæ­¤åŸå‰‡

### å…¶ä»–åŸå‰‡
- **Composition over Inheritance**: å„ªå…ˆä½¿ç”¨çµ„åˆè€Œéç¹¼æ‰¿
- **Law of Demeter**: æœ€å°‘çŸ¥è­˜åŸå‰‡
- **DRY (Don't Repeat Yourself)**: ä¸è¦é‡è¤‡è‡ªå·±

---

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

```
hotel-management-system/
â”œâ”€â”€ src/main/java/com/hotel/
â”‚   â”œâ”€â”€ Main.java (å·²æ›´æ–°)
â”‚   â””â”€â”€ model/
â”‚       â”œâ”€â”€ Person.java (å·²æ›´æ–° - æ–°å¢æ–¹æ³•)
â”‚       â”œâ”€â”€ FrontDeskStaff.java (å·²æ›´æ–° - Divergent Change)
â”‚       â”œâ”€â”€ Hotel.java (å·²æ›´æ–° - Refused Bequest)
â”‚       â”œâ”€â”€ Guest.java
â”‚       â”œâ”€â”€ Room.java
â”‚       â”œâ”€â”€ Chef.java
â”‚       â””â”€â”€ Housekeeper.java
â”œâ”€â”€ CODE_SMELL_DOCUMENTATION.md (å·²æ›´æ–°)
â”œâ”€â”€ README.md
â”œâ”€â”€ CHANGELOG.md (æ–°å¢)
â””â”€â”€ ä¿®æ”¹èªªæ˜.md (æœ¬æª”æ¡ˆ)
```

---

## ğŸš€ å¦‚ä½•åŸ·è¡Œ

### ç·¨è­¯
```bash
cd d:\java_program\Hw_middle\hotel-management-system
javac -encoding UTF-8 -d target/classes src/main/java/com/hotel/model/*.java src/main/java/com/hotel/*.java
```

### åŸ·è¡Œ
```bash
java -cp target/classes com.hotel.Main
```

---

## ğŸ“– åƒè€ƒè³‡æ–™

- **Refactoring: Improving the Design of Existing Code** by Martin Fowler
- **Clean Code** by Robert C. Martin
- **Design Patterns** by Gang of Four
- **SOLID Principles** - Robert C. Martin

---

## âœ¨ ç¸½çµ

æœ¬æ¬¡ä¿®æ”¹æˆåŠŸå°‡å°ˆæ¡ˆä¸­çš„ Code Smell å¾æ•™å­¸ç¯„ä¾‹å‡ç´šç‚ºæ›´è²¼è¿‘å¯¦éš›æƒ…æ³çš„æ¡ˆä¾‹ï¼š

1. âœ… **Divergent Change** å–ä»£ Switch Statement - æ›´å¥½åœ°å±•ç¤ºå–®ä¸€è·è²¬åŸå‰‡
2. âœ… **Refused Bequest** çœŸæ­£çš„ç¹¼æ‰¿å•é¡Œ - å±•ç¤º Liskov æ›¿æ›åŸå‰‡
3. âœ… æ‰€æœ‰ 15 å€‹ Code Smell éƒ½æœ‰æ¸…æ¥šçš„ç¨‹å¼ç¢¼ç¯„ä¾‹
4. âœ… è©³ç´°çš„æ–‡ä»¶èªªæ˜å’Œæ”¹å–„å»ºè­°
5. âœ… ç¨‹å¼å¯æ­£å¸¸ç·¨è­¯å’ŒåŸ·è¡Œ

å°ˆæ¡ˆç¾åœ¨æ˜¯ä¸€å€‹å®Œæ•´çš„ Code Smell æ•™å­¸ç¯„ä¾‹ï¼Œé©åˆç”¨æ–¼è»Ÿé«”å·¥ç¨‹ã€ç¨‹å¼ç¢¼å“è³ªã€æˆ–é‡æ§‹èª²ç¨‹ï¼
